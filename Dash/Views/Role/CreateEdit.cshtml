@using Dash.Models
@using Dash.Resources;
@model Role

<body-content>
    <breadcrumb>
        <breadcrumb-item label="@Roles.ViewAll" controller="Role" action="Index"></breadcrumb-item>
        <breadcrumb-item label="@(Model.IsCreate ? Roles.CreateRole : Roles.EditRole)" controller="Role" action="@Model.FormAction" route-values="@(Model.IsCreate ? null : new { Id = Model.Id })" is-active="true"></breadcrumb-item>
    </breadcrumb>

    <partial name="_Toast" />

    @using (Html.BeginCustomForm(Model.FormAction, "Role", method: Model.FormMethod))
    {
        @Html.HiddenFor(model => model.Id)

        <div class="columns">
            <div class="col-6">
                @Html.LabelInputFor(model => model.Name, new { autofocus = true })
            </div>
        </div>

        <div class="columns">
            <div class="col-6">
                <div class="form-group">
                    @Html.ControlLabel("PermissionIds", Dash.Resources.Roles.Permissions)
                    <div class="col-8 c-hand" data-toggle="collapsible-list">
                        @foreach (var controller in Model.ControllerPermissions.Keys)
                        {
                            <ul class="collapsible-list">
                                <li>
                                    @Html.CustomCheckbox("Controller", false, "", controller, inputId: $"controller_{controller}", isFullWidth: false, isMultiple: true)
                                    <ul class="collapsible-list">
                                        @foreach (var permission in Model.ControllerPermissions[controller])
                                        {
                                            <li>
                                                @Html.CustomCheckbox("PermissionIds", Html.IsChecked(Model.RolePermission, x => x.PermissionId == permission.Id, ((int[])ViewBag.SelectedPermissionIds), permission.Id), permission.Id.ToString(), permission.ActionName, isFullWidth: false, isMultiple: true)
                                            </li>
                                        }
                                    </ul>
                                </li>
                            </ul>
                        }
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="form-group columns">
                    @Html.ControlLabel("UserIds", Dash.Resources.Roles.Users)
                    <div class="col-8 checkbox-block">
                        @foreach (var user in Model.AllUsers)
                        {
                            @Html.CustomCheckbox("UserIds", Html.IsChecked(Model.UserRole, x => x.UserId == user.Id, ((int[])ViewBag.SelectedUserIds), user.Id), user.Id.ToString(), user.FullName, isMultiple: true)
                        }
                        @Html.Help("Role", "Users", false)
                    </div>
                </div>
            </div>
        </div>

        @Html.FormButtons()
    }
</body-content>
