@using Dash.Resources
@using Dash.Models
@model Dataset

@using (Html.BeginBodyContent())
{
    @Html.Breadcrumbs(new List<Breadcrumb> {
        new Breadcrumb(Datasets.ViewAll, "Index", "Dataset"),
        new Breadcrumb(Model.IsCreate ? Datasets.CreateDataset : Datasets.EditDataset, Model.FormAction, "Dataset", Model.IsCreate ? null : new { id = Model.Id })
    });

    <partial name="_Toast" />

    <tab-list>
        <tab-item>
            <a id="overviewTab" class="active" role="tab" data-toggle="tab" aria-controls="overviewContent">@Html.Raw(Datasets.Overview)</a>
        </tab-item>
        <tab-item no-render="@(Model.IsCreate || !User.IsInRole("datasetjoin.index"))">
            @Html.AuthorizedActionLink(Datasets.Joins, "Index", "DatasetJoin", new { Model.Id }, new { @class = "btn btn-link", role = "tab" })
        </tab-item>
        <tab-item no-render="@(Model.IsCreate || !User.IsInRole("datasetcolumn.index"))">
            @Html.AuthorizedActionLink(Datasets.Columns, "Index", "DatasetColumn", new { Model.Id }, new { @class = "btn btn-link", role = "tab" })
        </tab-item>
    </tab-list>

    <tab-panel id="overviewContent" label-id="overviewTab">
        @using (Html.BeginCustomForm(Model.FormAction, "Dataset", method: Model.FormMethod))
        {
            @Html.HiddenFor(model => model.Id)

            <div class="columns">
                <div class="col-6">
                    @Html.LabelInputFor(model => model.Name)
                    @Html.LabelDropDownListFor(model => model.DatabaseId, new SelectList(Model.DbContext.GetAll<Database>(), "Id", "Name"), new { @class = "dataset-database" })
                    @Html.LabelDropDownListFor(model => model.TypeId, Model.TypeList, new { @class = "dataset-type" })
                    @Html.LabelInputFor(model => model.PrimarySource, new { data_toggle = "autocomplete", data_url = Url.Action("Sources", "Dataset"), data_params = "#DatabaseId,#TypeId" })
                    @Html.LabelTextAreaFor(model => model.Description)
                    @Html.LabelTextAreaFor(model => model.Conditions)
                </div>

                <div class="col-6">
                    @Html.LabelInputFor(model => model.DateFormat, groupAddOn: Html.InputGroupButton("DateFormat", Html.Icon("list-numbered", false, true), Model.DefaultDateFormats))
                    @Html.LabelInputFor(model => model.CurrencyFormat, groupAddOn: Html.InputGroupButton("CurrencyFormat", Html.Icon("list-numbered", false, true), Model.DefaultCurrencyFormats))

                    <div class="form-group">
                        @Html.ControlLabel("RoleIds", Datasets.Roles)
                        <div class="col-8 checkbox-block">
                            @foreach (var role in Model.GetAllRoles())
                            {
                                @Html.CustomCheckbox("RoleIds", Html.IsChecked(Model.DatasetRole, x => x.RoleId == role.Id, (int[])ViewBag.SelectedRoleIds, role.Id), role.Id.ToString(), role.Name, $"dataset_role_{role.Id}", isMultiple: true)
                            }
                            @Html.HelpFor(model => model.DatasetRole, false)
                        </div>
                    </div>
                </div>
            </div>

            @Html.FormButtons()
        }
    </tab-panel>
}
